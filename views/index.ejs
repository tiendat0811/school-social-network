<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js" type="text/javascript"></script>
    <!-- CSS only -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
    <!-- JavaScript Bundle with Popper -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p"
        crossorigin="anonymous"></script>
    <script src="/socket.io/socket.io.js"></script>
    <script src="/javascripts/main.js"></script>
    <link rel="stylesheet" href="/stylesheets/style.css">

    <title>Home Page</title>
</head>

<body>
    <div class="new-notification">

    </div>
    <div class="index">
        <div class="container-fluid header">
            <button onclick="logout()">Logout</button>
        </div>
        <div class="container-fluid body">
            <div class="row">
                <div class="col col-2 navigation border border-2 rounded"></div>
                <div class="col col-7 content border border-2 rounded">
                    <% if(user.roles==='student' || user.roles==='admin' ){ %>
                        <div class="new-post-student">
                            <h3>Đăng bài</h3>
                            <div class="mb-3">
                                <textarea class="form-control" placeholder="Bạn đang nghĩ gì?" name="caption"
                                    id="caption"></textarea>
                            </div>
                            <div id="previewVideo" class=""></div>
                            <div class="previewImage"><img style="display: none;" id="imagePreview"
                                    class="img-fluid img-thumbnail rounded mb-3"></div>
                            <div class="add-attach mb-3">
                                <label class="btn btn-info dropdown-toggle " for="image">Thêm ảnh</label>
                                <input class="form-control" type="file" name="image" id="image" accept="image/*"
                                    onchange="previewImage(this);">
                                <input class="form-control mx-2" type="text"
                                    placeholder="Nhập đường dẫn video youtube của bạn" id="video" name="video"
                                    oninput="previewVideo()"><br>
                            </div>
                            <button class="btn btn-primary" type="submit" onclick="addPost()">Đăng bài</button>
                        </div>
                        <% } %>
                            <% if(user.roles==="manager" || user.roles==="admin" ){ %>
                                <div class="new-post-student">
                                    <h3>Đăng bài theo chuyên mục</h3>
                                    <div class="mb-3">
                                        <input type="text" class="form-control" placeholder="Tiêu đề" id="notiTitle">
                                    </div>
                                    <div class="mb-3">
                                        <input type="text" class="form-control" placeholder="Nội dung tóm tắt"
                                            id="notiSummary">
                                    </div>
                                    <div class="mb-3">
                                        <textarea class="form-control" placeholder="Nội dung chi tiết"
                                            id="notiDetail"></textarea>
                                    </div>
                                    <select class="form-select mb-3" aria-label="Default select example" id="permission"
                                        required>
                                        <option selected value="1">Chọn chuyên mục</option>
                                        <% if(user.roles==='admin' ){ for(let i=0; i < category.length; i++){ %>
                                            <option value="<%= category[i].category %>">
                                                <%= category[i].category %>
                                            </option>
                                            <% }} else{ %>
                                                <% for(let i=0; i < user.permission.length; i++){ %>
                                                    <option value="<%= category[i].category %>">
                                                        <%= user.permission[i] %>
                                                    </option>
                                                    <% } } %>
                                    </select>
                                    <button type="button" class="btn btn-primary" onclick="addNotification()">Đăng
                                        bài</button>
                                </div>

                                <% } %>
                                    <div class="timeline">
                                        <div class="newPost">
                                        </div>
                                        <% for(let i=0; i < post.length; i++){ %>
                                            <div class="post" id="id<%= post[i]._id %>">
                                                <div class="postOf">
                                                    <span class="fullname">
                                                        <%= post[i].fullname %>
                                                    </span><br>
                                                    <span class="time">
                                                        <%= post[i].createTime %>
                                                    </span>

                                                </div>
                                                <div class="caption">
                                                    <div class="caption-left">
                                                        <p id="id<%=post[i]._id%>" class="caption">
                                                            <%= post[i].caption %>
                                                        </p>
                                                        <input type="text" id="id<%=post[i]._id%>">
                                                        <div class="button-confirm d-flex">
                                                            <button onclick="unEditPost('<%=post[i]._id%>')"
                                                                id="id<%=post[i]._id%>"
                                                                class="m-2 btn-danger">Huỷ</button>
                                                            <button onclick="confirmEditPost('<%=post[i]._id%>')"
                                                                id="id<%=post[i]._id%>"
                                                                class="m-2 btn-success">Lưu</button>
                                                        </div>

                                                    </div>
                                                    <div class="caption-right">

                                                        <% if(user._id.toString()===post[i].user || user.roles==='admin'
                                                            ){ %>
                                                            <button type="button" class="btn btn-warning"
                                                                onclick="editPost('<%=post[i]._id%>')">Sửa</button>
                                                            <button type="button" class="btn btn-danger"
                                                                onclick="deletePost('<%=post[i]._id%>')">Xoá</button>

                                                            <% } %>


                                                    </div>
                                                </div>
                                                <div class="attach">
                                                    <div class="video">
                                                        <%- post[i].video %>
                                                    </div>
                                                    <% if(!post[i].image==='' ){ %>
                                                        <img class="image img-fluid img-thumbnail"
                                                            src="<%= post[i].image %>">
                                                        <% } %>
                                                </div>
                                                <div class="commentOfPost">
                                                    <div class="newComment mx-5 d-flex">
                                                        <input class="form-control" type="text" id="id<%=post[i]._id%>"
                                                            placeholder="Viết bình luận...">
                                                        <button class="btn btn-primary mx-2 "
                                                            onclick="addComment('<%=post[i]._id%>')">Gửi</button>
                                                    </div>
                                                    <div class="showComment py-2" id="<%=post[i]._id%>">
                                                        <div class="after-add-comment" id="id<%=post[i]._id%>">
                                                        </div>
                                                        <% for(let j=0; j<comment.length; j++){
                                                            if(comment[j].postId===post[i]._id.toString()){ %>
                                                            <div class="comment p-1"
                                                                id="id<%= comment[j]._id.toString() %>">
                                                                <div
                                                                    class="comment-content border border-2 mt-2 mx-2 p-2 bg-light rounded-3">
                                                                    <div class="comment-content-header d-flex">
                                                                        <p class="fw-bolder my-0 fs-6">
                                                                            <%= comment[j].fullname %>
                                                                        </p>
                                                                        <span class="time m-1 mb-0">
                                                                            <%= comment[j].createTime %>
                                                                        </span>
                                                                        <div class="d-flex tool-comment">
                                                                            <button
                                                                                class="font-monospace mx-2 link-info bg-white p-0.5 border border-2 rounded-3"
                                                                                onclick="editComment('<%=comment[j]._id.toString() %>')">
                                                                                Sửa
                                                                            </button>
                                                                            <button
                                                                                class="font-monospace link-danger bg-white p-0.5 border border-2 rounded-3"
                                                                                onclick="deleteComment('<%=comment[j]._id.toString() %>')">
                                                                                Xoá
                                                                            </button>
                                                                        </div>
                                                                    </div>
                                                                    <p class="comment-detail fs-6 my-0"
                                                                        id="id<%= comment[j]._id.toString() %>">
                                                                        <%= comment[j].comment %>
                                                                    </p>
                                                                    <input type="text"
                                                                        id="id<%= comment[j]._id.toString() %>">
                                                                    <div class="button-confirm d-flex">
                                                                        <button
                                                                            onclick="unEditComment('<%= comment[j]._id.toString() %>')"
                                                                            id="id<%= comment[j]._id.toString() %>"
                                                                            class="m-2 btn-danger">Huỷ</button>
                                                                        <button
                                                                            onclick="confirmEditComment('<%= comment[j]._id.toString() %>')"
                                                                            id="id<%= comment[j]._id.toString() %>"
                                                                            class="m-2 btn-success">Lưu</button>
                                                                    </div>
                                                                </div>

                                                            </div>
                                                            <% } } %>
                                                    </div>
                                                </div>
                                            </div>
                                            <% } %>
                                    </div>
                </div>
                <div class="col col-3 notification border border-2 rounded"></div>
            </div>
        </div>
    </div>
</body>

</html>